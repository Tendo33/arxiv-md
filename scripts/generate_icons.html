<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Icon Generator - arXiv to Markdown</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background-color: #f3f4f6;
        gap: 20px;
      }
      .container {
        background: white;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      canvas {
        border: 1px solid #e5e7eb;
        margin: 10px;
        border-radius: 8px;
      }
      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        margin-top: 20px;
        transition: opacity 0.2s;
      }
      .btn:hover {
        opacity: 0.9;
      }
      .preview-row {
        display: flex;
        align-items: flex-end;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
      }
      .label {
        font-size: 12px;
        color: #6b7280;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Icon Generator</h1>
      <p>Right-click and "Save Image As" or use the download button.</p>

      <div class="preview-row">
        <div>
          <canvas id="canvas128" width="128" height="128"></canvas>
          <div class="label">128x128</div>
        </div>
        <div>
          <canvas id="canvas48" width="48" height="48"></canvas>
          <div class="label">48x48</div>
        </div>
        <div>
          <canvas id="canvas16" width="16" height="16"></canvas>
          <div class="label">16x16</div>
        </div>
      </div>

      <button class="btn" onclick="downloadAll()">Download All Assets</button>
    </div>

    <script>
      // {{RIPER-7 Action}}
      // Role: LD | Task: 修改HTML以支持从图片生成多尺寸图标
      // Logic: 加载用户自定义icon.png，使用Canvas缩放生成16/48/128尺寸
      // Principle: SOLID-S (单一职责 - 图片缩放)

      let sourceImage = null;

      function loadSourceImage() {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => {
            sourceImage = img;
            resolve(img);
          };
          img.onerror = reject;
          // 从上级目录的 assets 文件夹加载
          img.src = "../assets/icon.png";
        });
      }

      function drawIconFromImage(ctx, size) {
        if (!sourceImage) {
          console.error("Source image not loaded");
          return;
        }

        // 清空画布
        ctx.clearRect(0, 0, size, size);

        // 使用高质量缩放
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "high";

        // 绘制缩放后的图片
        ctx.drawImage(sourceImage, 0, 0, size, size);
      }

      async function init() {
        try {
          // 加载源图片
          await loadSourceImage();

          const sizes = [128, 48, 16];

          sizes.forEach((size) => {
            const canvas = document.getElementById(`canvas${size}`);
            const ctx = canvas.getContext("2d");
            drawIconFromImage(ctx, size);
          });
        } catch (error) {
          alert(
            "无法加载 icon.png，请确保文件位于 ../assets/icon.png\n\n错误: " +
              error.message,
          );
          console.error("Failed to load source image:", error);
        }
      }

      function downloadAll() {
        const sizes = [128, 48, 16];
        sizes.forEach((size) => {
          const canvas = document.getElementById(`canvas${size}`);
          const link = document.createElement("a");
          link.download = `icon-${size}.png`;
          link.href = canvas.toDataURL("image/png");
          link.click();
        });
      }

      window.onload = init;
    </script>
  </body>
</html>
